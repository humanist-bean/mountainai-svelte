import{s as le,v as ke,n as be,G as ye,e as L,g as b,h as y,i as S,q as X,k as w,A as q,p as ee,l as P,c as F,m as V,d as U,j as ue,E as Y,D as we}from"./scheduler.9341ea61.js";import{h as oe,u as Me}from"./await_block.0d1876eb.js";import{p as Z,f as D,q as ie,r as re,g as xe}from"./header.8449f224.js";import{S as fe,i as de,d as T,v as he,a as j,h as Ie,t as G,c as Ce,b as J,e as _,g,n as d,p as B,s as N,q as se}from"./index.66f07722.js";import{t as Ee,a as Se}from"./transitions.c6f22e03.js";async function ae(a){const e=`https://en.wikipedia.org/w/api.php?action=query&list=search&prop=info&
    inprop=url&utf8=&format=json&origin=*&srlimit=20&srsearch=${a}`;let t;try{t=(await(await fetch(e)).json()).query.search[0],console.log("Retrieved top prediction result from wikipedia successfully:")}catch(o){console.log("An error occurred in 1:",o)}console.log(t);const i=await t.title,c=encodeURI(`https://en.wikipedia.org/w/api.php?action=parse&origin=*&format=json&page=${i}`);let s;try{const o=await fetch(c);console.log(o),s=await(await o.json()).parse.text["*"],console.log("Retrieved top page html from wikipedia api successfully:")}catch(o){console.log("An error occurred in 2:",o)}const l=await s,{mainImageUrl:n,extractedText:u}=await Re(l);return new Promise((o,r)=>{try{o({mainImageUrl:n,extractedText:u,topTitle:i})}catch(f){console.log("An error occurred in 3:",f),r(f)}})}async function Re(a){return new Promise((e,t)=>{try{const i=document.createElement("div");i.innerHTML=a;const c=i.querySelector(".infobox"),s=i.querySelectorAll("p"),l=i.querySelector("h2");let n="";for(const r of s){if(r===l)break;n+=r.textContent.trim()+" "}n=n.trim();const o=c.querySelector("img").getAttribute("src");console.log("Main Image URL:",o),console.log("Extracted Text is: ",n),console.log("Successfully extracted relevant mountain information from wikipedia!"),e({mainImageUrl:o,extractedText:n})}catch(i){console.log("An error occurred in 3:",i),t(i)}})}const{console:je}=xe,C="src/routes/result/MainMountain.svelte";function me(a){let e,t,i="... Waiting for Prediction Result, if waiting longer than 1min select new file ...",c,s;const l={c:function(){e=b("div"),t=b("h1"),t.textContent=i,this.h()},l:function(u){e=y(u,"DIV",{});var o=S(e);t=y(o,"H1",{class:!0,["data-svelte-h"]:!0}),X(t)!=="svelte-8s8gd3"&&(t.textContent=i),o.forEach(_),this.h()},h:function(){g(t,"class","s-Vz_61xhys8Zb"),w(t,C,70,7,2698),w(e,C,69,4,2668)},m:function(u,o){j(u,e,o),d(e,t),s=!0},p:q,i:function(u){s||(u&&ee(()=>{s&&(c||(c=B(e,D,{},!0)),c.run(1))}),s=!0)},o:function(u){u&&(c||(c=B(e,D,{},!1)),c.run(0)),s=!1},d:function(u){u&&_(e),u&&c&&c.end()}};return T("SvelteRegisterBlock",{block:l,id:me.name,type:"else",source:"(69:0) {:else}",ctx:a}),l}function _e(a){let e,t,i,c=a[0].class_id.toUpperCase()+"",s,l,n,u,o=(a[0].prediction_confidence*100).toFixed(2)+"",r,f,m,E,A,I,p={ctx:a,current:null,token:null,hasCatch:!0,pending:ge,then:ve,catch:pe,value:3,error:4,blocks:[,,,]};oe(A=a[1],p);const O={c:function(){e=b("div"),t=b("h1"),i=P("Top Prediction Result: "),s=P(c),l=F(),n=b("br"),u=P(` \r
            Confidence: `),r=P(o),f=P("%"),m=F(),E=L(),p.block.c(),this.h()},l:function(h){e=y(h,"DIV",{class:!0});var v=S(e);t=y(v,"H1",{class:!0});var k=S(t);i=V(k,"Top Prediction Result: "),s=V(k,c),l=U(k),n=y(k,"BR",{}),u=V(k,` \r
            Confidence: `),r=V(k,o),f=V(k,"%"),k.forEach(_),v.forEach(_),m=U(h),E=L(),p.block.l(h),this.h()},h:function(){w(n,C,45,78,1838),g(t,"class","s-Vz_61xhys8Zb"),w(t,C,45,8,1768),g(e,"class","prediction-container s-Vz_61xhys8Zb"),w(e,C,44,4,1724)},m:function(h,v){j(h,e,v),d(e,t),d(t,i),d(t,s),d(t,l),d(t,n),d(t,u),d(t,r),d(t,f),j(h,m,v),j(h,E,v),p.block.m(h,p.anchor=v),p.mount=()=>E.parentNode,p.anchor=E,I=!0},p:function(h,v){a=h,(!I||v&1)&&c!==(c=a[0].class_id.toUpperCase()+"")&&N(s,c),(!I||v&1)&&o!==(o=(a[0].prediction_confidence*100).toFixed(2)+"")&&N(r,o),p.ctx=a,v&2&&A!==(A=a[1])&&oe(A,p)||Me(p,a,v)},i:function(h){I||(J(p.block),I=!0)},o:function(h){for(let v=0;v<3;v+=1){const k=p.blocks[v];G(k)}I=!1},d:function(h){h&&(_(e),_(m),_(E)),p.block.d(h),p.token=null,p=null}};return T("SvelteRegisterBlock",{block:O,id:_e.name,type:"if",source:"(44:0) {#if $prediction_store}",ctx:a}),O}function pe(a){let e,t=a[4].message+"",i;const c={c:function(){e=b("p"),i=P(t),this.h()},l:function(l){e=y(l,"P",{style:!0});var n=S(e);i=V(n,t),n.forEach(_),this.h()},h:function(){ue(e,"color","red"),w(e,C,66,8,2598)},m:function(l,n){j(l,e,n),d(e,i)},p:function(l,n){n&2&&t!==(t=l[4].message+"")&&N(i,t)},i:q,o:q,d:function(l){l&&_(e)}};return T("SvelteRegisterBlock",{block:c,id:pe.name,type:"catch",source:"(66:4) {:catch error}",ctx:a}),c}function ve(a){let e,t,i,c=a[3].topTitle+"",s,l,n,u,o,r,f,m,E="Description",A,I,p=a[3].extractedText+"",O,M,h;const v={c:function(){e=b("div"),t=b("div"),i=b("h2"),s=P(c),l=F(),n=b("img"),r=F(),f=b("div"),m=b("h3"),m.textContent=E,A=F(),I=b("p"),O=P(p),this.h()},l:function(x){e=y(x,"DIV",{class:!0});var R=S(e);t=y(R,"DIV",{class:!0});var W=S(t);i=y(W,"H2",{style:!0});var te=S(i);s=V(te,c),te.forEach(_),l=U(W),n=y(W,"IMG",{class:!0,height:!0,src:!0,alt:!0}),W.forEach(_),r=U(R),f=y(R,"DIV",{class:!0});var z=S(f);m=y(z,"H3",{["data-svelte-h"]:!0}),X(m)!=="svelte-1ihs9ro"&&(m.textContent=E),A=U(z),I=y(z,"P",{class:!0});var ne=S(I);O=V(ne,p),ne.forEach(_),z.forEach(_),R.forEach(_),this.h()},h:function(){ue(i,"font-weight","bold"),w(i,C,53,16,2134),g(n,"class","top-mountain-image s-Vz_61xhys8Zb"),g(n,"height","20rem"),Y(n.src,u=a[3].mainImageUrl)||g(n,"src",u),g(n,"alt",o=a[3].topTitle),w(n,C,56,16,2253),g(t,"class","s-Vz_61xhys8Zb"),w(t,C,52,12,2111),w(m,C,59,16,2426),g(I,"class","s-Vz_61xhys8Zb"),w(I,C,60,16,2464),g(f,"class","scroll-overflow s-Vz_61xhys8Zb"),w(f,C,58,12,2379),g(e,"class","flex-container s-Vz_61xhys8Zb"),w(e,C,51,8,2053)},m:function(x,R){j(x,e,R),d(e,t),d(t,i),d(i,s),d(t,l),d(t,n),d(e,r),d(e,f),d(f,m),d(f,A),d(f,I),d(I,O),h=!0},p:function(x,R){(!h||R&2)&&c!==(c=x[3].topTitle+"")&&N(s,c),(!h||R&2&&!Y(n.src,u=x[3].mainImageUrl))&&g(n,"src",u),(!h||R&2&&o!==(o=x[3].topTitle))&&g(n,"alt",o),(!h||R&2)&&p!==(p=x[3].extractedText+"")&&N(O,p)},i:function(x){h||(x&&ee(()=>{h&&(M||(M=B(e,D,{},!0)),M.run(1))}),h=!0)},o:function(x){x&&(M||(M=B(e,D,{},!1)),M.run(0)),h=!1},d:function(x){x&&_(e),x&&M&&M.end()}};return T("SvelteRegisterBlock",{block:v,id:ve.name,type:"then",source:"(51:4) {:then wiki}",ctx:a}),v}function ge(a){let e,t="...waiting for contents from wikipedia";const i={c:function(){e=b("p"),e.textContent=t,this.h()},l:function(s){e=y(s,"P",{["data-svelte-h"]:!0}),X(e)!=="svelte-x4olrp"&&(e.textContent=t),this.h()},h:function(){w(e,C,49,8,1980)},m:function(s,l){j(s,e,l)},p:q,i:q,o:q,d:function(s){s&&_(e)}};return T("SvelteRegisterBlock",{block:i,id:ge.name,type:"pending",source:"(49:20)           <p>...waiting for contents from wikipedia</p>      {:then wiki}",ctx:a}),i}function $(a){let e,t,i,c;const s=[_e,me],l=[];function n(o,r){return o[0]?0:1}e=n(a),t=l[e]=s[e](a);const u={c:function(){t.c(),i=L()},l:function(r){t.l(r),i=L()},m:function(r,f){l[e].m(r,f),j(r,i,f),c=!0},p:function(r,[f]){let m=e;e=n(r),e===m?l[e].p(r,f):(Ie(),G(l[m],1,1,()=>{l[m]=null}),Ce(),t=l[e],t?t.p(r,f):(t=l[e]=s[e](r),t.c()),J(t,1),t.m(i.parentNode,i))},i:function(r){c||(J(t),c=!0)},o:function(r){G(t),c=!1},d:function(r){r&&_(i),l[e].d(r)}};return T("SvelteRegisterBlock",{block:u,id:$.name,type:"component",source:"",ctx:a}),u}function Te(a,e,t){let i;ke(Z,"prediction_store"),be(a,Z,o=>t(0,i=o));let{$$slots:c={},$$scope:s}=e;he("MainMountain",c,[]);async function l(){if(i){console.log("Prediction store set, attempting to get Wikipedia data");try{const o=await ie(i.class_id);if(o)return console.log("WikiInfo Retrieved from Firestore wikiCache"),o;{console.log("WikiInfo not in Firestore cache, retrieving it from Wikipedia and uploading to Firestore");const r=await ae(i.class_id);return await re(i.class_id,r.mainImageUrl,r.extractedText,r.topTitle),Promise.resolve(r)}}catch(o){return console.log("An error occurred:",o),Promise.reject(o)}}else return console.log("Prediction store is undefined!"),Promise.reject(new Error("Prediction store is undefined"))}let n;const u=[];return Object.keys(e).forEach(o=>{!~u.indexOf(o)&&o.slice(0,2)!=="$$"&&o!=="slot"&&je.warn(`<MainMountain> was created with unknown prop '${o}'`)}),a.$capture_state=()=>({fade:D,get:ye,transition_start:Ee,transition_end:Se,prediction_store:Z,getWikiInfoFromName:ae,getWikiCache:ie,uploadWikiInfoToFirestore:re,fetchWikiData:l,promise:n,$prediction_store:i}),a.$inject_state=o=>{"promise"in o&&t(1,n=o.promise)},e&&"$$inject"in e&&a.$inject_state(e.$$inject),a.$$.update=()=>{a.$$.dirty&1&&i&&t(1,n=l())},[i,n]}class Fe extends fe{constructor(e){super(e),de(this,e,Te,$,le,{}),T("SvelteRegisterComponent",{component:this,tagName:"MainMountain",options:e,id:$.name})}}const H="src/routes/result/MountainList.svelte";function ce(a,e,t){const i=a.slice();return i[1]=e[t],i}function K(a){let e,t,i=a[1]+"",c,s,l,n,u;const o={c:function(){e=b("div"),t=b("h3"),c=P(i),s=F(),l=b("img"),u=F(),this.h()},l:function(f){e=y(f,"DIV",{class:!0});var m=S(e);t=y(m,"H3",{class:!0});var E=S(t);c=V(E,i),E.forEach(_),s=U(m),l=y(m,"IMG",{src:!0,alt:!0,class:!0}),u=U(m),m.forEach(_),this.h()},h:function(){g(t,"class","s-OOuafSNkY0Fu"),w(t,H,11,12,352),Y(l.src,n="/images/"+a[1]+".jpg")||g(l,"src",n),g(l,"alt",""),g(l,"class","s-OOuafSNkY0Fu"),w(l,H,12,12,385),g(e,"class","s-OOuafSNkY0Fu"),w(e,H,10,8,333)},m:function(f,m){j(f,e,m),d(e,t),d(t,c),d(e,s),d(e,l),d(e,u)},p:q,d:function(f){f&&_(e)}};return T("SvelteRegisterBlock",{block:o,id:K.name,type:"each",source:"(10:4) {#each mountains as mountain}",ctx:a}),o}function Q(a){let e,t,i,c=se(a[0]),s=[];for(let n=0;n<c.length;n+=1)s[n]=K(ce(a,c,n));const l={c:function(){e=b("div");for(let u=0;u<s.length;u+=1)s[u].c();this.h()},l:function(u){e=y(u,"DIV",{class:!0});var o=S(e);for(let r=0;r<s.length;r+=1)s[r].l(o);o.forEach(_),this.h()},h:function(){g(e,"class","list-flex-container s-OOuafSNkY0Fu"),w(e,H,8,0,239)},m:function(u,o){j(u,e,o);for(let r=0;r<s.length;r+=1)s[r]&&s[r].m(e,null);i=!0},p:function(u,[o]){if(o&1){c=se(u[0]);let r;for(r=0;r<c.length;r+=1){const f=ce(u,c,r);s[r]?s[r].p(f,o):(s[r]=K(f),s[r].c(),s[r].m(e,null))}for(;r<s.length;r+=1)s[r].d(1);s.length=c.length}},i:function(u){i||(u&&ee(()=>{i&&(t||(t=B(e,D,{},!0)),t.run(1))}),i=!0)},o:function(u){u&&(t||(t=B(e,D,{},!1)),t.run(0)),i=!1},d:function(u){u&&_(e),we(s,u),u&&t&&t.end()}};return T("SvelteRegisterBlock",{block:l,id:Q.name,type:"component",source:"",ctx:a}),l}function Pe(a,e,t){let{$$slots:i={},$$scope:c}=e;he("MountainList",i,[]);let s=["Mt. Rainier","Mt. Thielsen","Diamond Peak","Mt. Hood","Mt. Jefferson"];const l=[];return Object.keys(e).forEach(n=>{!~l.indexOf(n)&&n.slice(0,2)!=="$$"&&n!=="slot"&&console.warn(`<MountainList> was created with unknown prop '${n}'`)}),a.$capture_state=()=>({fade:D,mountains:s}),a.$inject_state=n=>{"mountains"in n&&t(0,s=n.mountains)},e&&"$$inject"in e&&a.$inject_state(e.$$inject),[s]}class Ue extends fe{constructor(e){super(e),de(this,e,Pe,Q,le,{}),T("SvelteRegisterComponent",{component:this,tagName:"MountainList",options:e,id:Q.name})}}export{Fe as M,Ue as a};
